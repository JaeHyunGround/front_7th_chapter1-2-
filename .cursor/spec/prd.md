# 제품 요구사항 문서 (PRD)

## 1. 개요

- 제품/기능 한줄 요약: 캘린더 앱에서 일정 생성/수정 시 반복 유형(매일/매주/매월/매년)을 선택하고 저장한다.
- 문맥(레포 개요, 기술스택): React 19 + TypeScript + Vite + MUI UI, notistack 알림, Vitest 테스트. 일정 CRUD는 `/api/events`(MSW 서버 모킹) 경유. 현재 UI에 반복 토글만 노출되어 있고 반복 상세 UI는 주석 처리됨.

## 2. 문제 정의

- 현재 문제/기회: 반복 일정의 타입/간격/종료일을 선택, 저장, 표시하는 플로우가 미완성이다. 반복 규칙의 경계 사례(2/29, 31일 등)와 겹침 정책 정의가 필요하다.
- 사용자/비즈니스 영향: 반복 일정이 없으면 동일 이벤트를 다수 생성해야 하며, 입력/관리 부담과 오류가 커진다. 반복 기능은 일정 관리 기본 기대치다.

## 3. 목표와 비목표

- 목표:
  - 일정 생성/수정 시 반복 유형 선택: 매일/매주/매월/매년
  - 반복 간격(기본 1)과 종료일(옵션) 지정 가능
  - 특수 날짜 규칙 준수: 2/29(윤년), 31일 처리 규칙
  - 저장된 반복 정보가 리스트/뷰에서 일관되게 표시
  - 반복일정은 일정 겹침 검사를 고려하지 않음(요구 명시)
- 비목표(범위 제외):
  - 반복 인스턴스의 개별 편집/예외 처리(SNOOZE, 단건 삭제 등)
  - 고급 규칙(RRULE, 특정 요일 N번째 등)
  - 알림의 반복 인스턴스별 스케줄링 고도화

## 4. 이해관계자 및 사용자

- 내부: 프론트엔드 개발자, QA, SM, PO
- 외부/사용자 세그먼트: 반복 일정을 자주 사용하는 일반 사용자(개인/업무)

## 5. 가정 및 근거

- 가정:
  - 반복 저장 스키마는 `RepeatInfo { type, interval, endDate? }`로 유지한다.
  - UI는 주석된 반복 섹션을 활성화하여 구현하며 기본값은 interval=1, endDate 없음.
  - 반복 일정 겹침은 무시한다(저장 전 찾더라도 경고 없이 진행). 단, 단일 일정은 기존 겹침 경고 유지.
- 근거(파일/경로/링크):
  - 타입 정의: `src/types.ts`의 `RepeatType`, `RepeatInfo`, `Event` 구조
  - 저장/조회 흐름: `src/hooks/useEventOperations.ts` (POST/PUT 후 fetchEvents)
  - 폼 상태: `src/hooks/useEventForm.ts`의 `isRepeating`, `repeatType`, `repeatInterval`, `repeatEndDate`
  - 앱 저장 시 repeat 포함 및 겹침 검사 위치: `src/App.tsx`의 `addOrUpdateEvent`
  - 겹침 유틸 및 테스트: `src/utils/eventOverlap.ts`, `src/__tests__/unit/easy.eventOverlap.spec.ts`

## 6. 요구사항

### 6.1 기능 요구사항

- [FR1] 반복 토글 표시 및 상태 반영

  - 설명: isRepeating 체크 시 반복 설정 UI 노출. 해제 시 type=none, interval=1, endDate 제거.
  - 수용 기준(AC):
    - isRepeating=ON일 때 반복 유형/간격/종료일 UI가 표시된다.
    - isRepeating=OFF로 저장 시 이벤트의 `repeat`는 `{ type:'none', interval:1 }`로 저장된다.

- [FR2] 반복 유형 선택

  - 설명: 옵션은 daily, weekly, monthly, yearly. 기본값은 none.
  - AC:
    - 사용자가 유형을 변경하면 폼 상태에 반영되고 저장 후 이벤트 카드에 반영된다.
    - 유형 값은 `Event.repeat.type`에 직렬화되어 서버로 전송된다.

- [FR3] 반복 간격 입력

  - 설명: 1 이상의 정수. 기본 1.
  - AC:
    - 0 이하/소수가 입력되면 저장이 불가하고 오류 메시지 또는 입력 제한이 동작한다.
    - 유효한 값은 `Event.repeat.interval`로 저장된다.

- [FR4] 반복 종료일(선택)

  - 설명: 종료일이 지정되면 해당 날짜까지 포함하여 반복 생성/표시(포함 규칙).
  - AC:
    - 비워두면 종료일이 없는 반복으로 저장된다(`endDate` 미설정).
    - 값이 있으면 `Event.repeat.endDate`에 ISO-YYYY-MM-DD로 저장된다.

- [FR5] 특수 날짜 규칙

  - 설명:
    - 31일에 monthly 선택 시: “매월 마지막”이 아닌 “매월 31일”에만 생성(31일 없는 달에는 생성하지 않음).
    - 윤년 2월 29일에 yearly 선택 시: 2/29에만 생성(윤년이 아닌 해에는 생성하지 않음).
  - AC:
    - 테스트 케이스로 1/31→2월/4월 미생성, 3월 생성 통과.
    - 2024-02-29 yearly 저장 시 2025/2026 미생성, 2028 생성 통과.

- [FR6] 반복일정의 겹침 정책

  - 설명: 반복 인스턴스는 겹침을 고려하지 않음. 저장 시 겹침 경고 없이 진행. 단건 일정은 기존 겹침 경고 로직 유지.
  - AC:
    - 반복 이벤트 저장 시 겹침 다이얼로그가 나타나지 않는다(반복 전개 시에도 동일 정책 유지).
    - 단건 일정은 현행 `findOverlappingEvents`에 따라 경고가 노출된다.

- [FR7] 표시 요구사항
  - 설명: 이벤트 리스트와 주/월 뷰에서 반복 메타 정보(간격, 단위, 종료일)를 텍스트로 노출.
  - AC:
    - `event.repeat.type !== 'none'`이면 리스트 카드에 “반복: <interval><단위>마다 (종료: YYYY-MM-DD)” 형식이 노출된다.
    - 주/월 뷰의 셀에서도 동일 이벤트에 대한 메타가 확인 가능하다.

### 6.2 비기능 요구사항

- 성능: 월 뷰(최대 6주) 렌더 시 반복 전개가 있어도 100ms 내 인터랙션에 지장 없도록 단순 계산 또는 메모이제이션 고려(필요 시 가상화는 제외).
- 가용성: 폼 유효성 검증(시간 형식, 간격 범위) 실패 시 토스트/툴팁으로 피드백.
- 관측성: 주요 행위(저장 성공/실패, 초기 로딩)는 notistack로 일관 메시지.

## 7. 사용자 스토리

- (사용자)로서, 나는 “회의” 일정을 매주 반복으로 설정해 자동으로 관리하고 싶다, 그래서 수동 반복 생성의 번거로움을 줄인다.
- (사용자)로서, 나는 2/29 생일을 매년 반복으로 저장하고 싶다, 그래서 윤년이 아닌 해에는 생일 일정이 나타나지 않게 한다.
- (사용자)로서, 나는 31일 급여 이체를 매월 반복으로 설정하고 싶다, 그래서 30일/2월에는 생성되지 않게 한다.

## 8. 데이터 및 흐름(선택)

- 주요 타입/데이터 모델:
  - `Event { ..., repeat: { type: 'none'|'daily'|'weekly'|'monthly'|'yearly', interval: number, endDate?: string } }`
- 흐름 요약:
  1. 폼에서 isRepeating ON → type/interval/endDate 입력 → 저장 시 `repeat` 반영
  2. 리스트/뷰에서 `repeat` 메타 텍스트 노출(현 구현 존재)
  3. 반복 인스턴스 전개는 서버/클라이언트 기준 선택(본 PRD는 메타 저장과 표시 중심, 전개 로직은 차기 범위)

## 9. 범위 및 마일스톤

- MVP:
  - 폼 UI 활성화(반복 유형/간격/종료일), 저장, 리스트/뷰 메타 표시, 특수 날짜 규칙 문서화 및 단위 테스트 설계 수준
- 확장(차기):
  - 클라이언트 전개 로직(주/월 뷰에 반복 인스턴스 실제 생성/표시), 예외 편집, RRULE 호환

## 10. 성공 지표

- 기능 채택: 반복 옵션을 사용한 저장 비율 ≥ 30%
- 품질: 특수 날짜 규칙 단위 테스트 100% 통과
- 안정성: 저장 실패율 < 1%

## 11. 리스크 및 대응

- 규칙 해석 혼동(31일/2월, 2/29): 문서/테스트로 명확화하고 UI 설명 추가
- 성능 이슈(반복 전개): MVP는 전개 제외, 차기에서 최적화 검토

## 12. 오픈 이슈(질문)

- 반복 전개 책임 위치: 서버(인스턴스 생성) vs 클라이언트(동적 계산)?
- 겹침 무시 범위: 반복 인스턴스 저장 시 전부 무시인지, 단건 저장만 무시인지?
- 종료일 포함 규칙: 종료일 당일 포함 여부(본 PRD는 포함으로 가정)

## 13. 참고

- `src/types.ts`
- `src/hooks/useEventOperations.ts`
- `src/hooks/useEventForm.ts`
- `src/App.tsx`
- `src/utils/eventOverlap.ts`
- `src/__tests__/unit/easy.eventOverlap.spec.ts`
